<!doctype html>
<!--
* Tabler - Premium and Open Source dashboard template with responsive and high quality UI.
* @version 1.0.0-beta10
* @link https://tabler.io
* Copyright 2018-2022 The Tabler Authors
* Copyright 2018-2022 codecalm.net Paweł Kuna
* Licensed under MIT (https://github.com/tabler/tabler/blob/master/LICENSE)
-->
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Design Proposal - Welcome</title>
    <!-- CSS files -->
    <link href="./dist/css/tabler.min.css" rel="stylesheet" />
    <link href="./dist/css/tabler-flags.min.css" rel="stylesheet" />
    <link href="./dist/css/tabler-payments.min.css" rel="stylesheet" />
    <link href="./dist/css/tabler-vendors.min.css" rel="stylesheet" />
    <link href="./dist/css/demo.min.css" rel="stylesheet" />

    <script src="https://unpkg.com/ipfs-http-client-lite/dist/index.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.0.umd.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ethjs@0.3.4/dist/ethjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>

<body>
    <div class="page">
        <header class="navbar navbar-expand-md navbar-light d-print-none">
            <div class="container-xl">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu">
            <span class="navbar-toggler-icon"></span>
          </button>
                <h1 class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
                    <a href=".">
                        <img src="./static/logo.svg" width="110" height="32" alt="Tabler" class="navbar-brand-image">
                    </a>
                </h1>
                <div class="navbar-nav flex-row order-md-last">
                    <div class="nav-item d-none d-md-flex me-3">
                        <div class="btn-list">
                            <a id="connect_web_3" href="#" class="btn" rel="noreferrer">
                                Connect Web 3
                            </a>
                        </div>
                    </div>


                </div>
            </div>
        </header>
        <div class="navbar-expand-md">
            <div class="collapse navbar-collapse" id="navbar-menu">
                <div class="navbar navbar-light">
                    <div class="container-xl">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="./index.html">
                                    <span class="nav-link-icon d-md-none d-lg-inline-block"><!-- Download SVG icon from http://tabler-icons.io/i/home -->
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="5 12 3 12 12 3 21 12 19 12" /><path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" /><path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" /></svg>
                    </span>
                                    <span class="nav-link-title">
                      Home
                    </span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <span id="show_wallet"></span>
                            </li>
                        </ul>
                        <div class="my-2 my-md-0 flex-grow-1 flex-md-grow-0 order-first order-md-last">
                            <form action="." method="get">
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <!-- Download SVG icon from http://tabler-icons.io/i/search -->
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7" /><line x1="21" y1="21" x2="15" y2="15" /></svg>
                                    </span>
                                    <input type="text" value="" class="form-control" placeholder="Search…" aria-label="Search in website">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="page-wrapper">
            <div class="container-xl">
                <!-- Page title -->
                <div class="page-header d-print-none">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <h2 class="page-title">
                                Design Proposal dashboard
                            </h2>
                            <span id="proposal_create_hash_display"></span>
                        </div>
                        <!-- Page title actions -->
                        <div class="col-12 col-md-auto ms-auto d-print-none">
                            <div class="btn-list">
                                <span class="d-none d-sm-inline">
                                
                        <a href="#" class="btn btn-primary d-none d-sm-inline-block" data-bs-toggle="modal" data-bs-target="#modal-report">
                            <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>Create Draft Proposal
                        </a>
                        <a href="#" class="btn btn-primary d-sm-none btn-icon" data-bs-toggle="modal" data-bs-target="#modal-report" aria-label="Create new report">
                            <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>
                        </a>
                    </div>
                </div>
            </div>
                </div>
            </div>
            <div class="page-body">
                <div class="container-fluid">
                    <div class="row">
                        <table> 
                            <tr>
                                <td rowspan="2" style="vertical-align:top"> 
                                    <div class="col-sm-6 col-lg-12">                
                                        <div class="card">
                                            <div class="card-body p-0">
                                                <div class="card-table table-responsive">                                                               
                                                    <table id="proposal_list_table" class="table table-vcenter">
                                                        <thead>
                                                            <tr>
                                                                <th>Proposal</th>
                                                                <th>DAO</th>
                                                                <th>Title</th>
                                                                <th>Status</th>
                                                                <th>Target Submit Date</th>                                                                
                                                            </tr>
                                                        </thead>
                                                        <tbody>                            
                                                        </tbody>
                                                    </table>  
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td  style="vertical-align:top">
                                    <div class="col-sm-3 col-lg-12">
                                        <span id="draft_proposal_info_card">
                                            <div class="card">
                                            <div class="card-body">
                                                <div class="row row-0">
                                                    <div class="col-3">
                                                        <h4>PROPOSAL STATUS: <span id="proposal_status_display">${proposal status}</span></h4>
                                                        <span id="proposal_image_display"><img src="./static/photos/2854fd67ddbd6217.jpg" class="w-75 h-75 " alt="Card side image"></span>
                                                    </div>
                                                    <div class="col-9">
                                                        <div class="card-body">
                                                            <h3 class="card-title"><span id="proposal_title_display">${proposal title}</span></h3>
                                                            <div class="row">
                                                                <div class="col-lg-3"><label class="form-label">DAO</label><a id="proposal_dao_display" href="">${dao}</a></div>
                                                                <div class="col-lg-3"><label class="form-label">Proposal Owner</label> <span id="proposal_owner_name_display">${name}</span><br/><span id="proposal_owner_address_display">${0x000000000000000000000000}</span></div>
                                                                <div class="col-lg-3"><label class="form-label">Target Submission Date</label> <span id="target_submission_date_display">${2022/10/31}</span></div>
                                                                <div class="col-lg-3"><label class="form-label">Proposal Background</label><a id="background_data_url_display" href="">${background data}</a></div>
                                                                <div class="col-lg-3"><label class="form-label">Proposal Currency</label> <span id="proposal_currency_display">${USDC}</span></div>
                                                                <div class="col-lg-3"><label class="form-label">Section Addition Fee</label> <span id="section_creation_fee_span">${45 USDC}</span></div>
                                                                <div class="col-lg-3"><label class="form-label">Cycle Time</label> <span id="section_vote_cycle_time_display">${10 mins}</span></div>
                                                                <div class="col-lg-3"><label class="form-label">Vote Fee</label> <span id="section_vote_fee_span">${5 USDC}</span></div>
                                                                <div class="col-lg-3"><span id="withdraw_proposal_button_display"></span></div>
                                                                <div class="col-lg-3"><span id="add_proposal_section_button_display"></span></div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-lg-12">
                                                                    <h4>Additional Information</h4>
                                                                    <p class="text-muted"><span id="additional_information_display">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aperiam deleniti fugit incidunt, iste, itaque minima neque pariatur perferendis sed suscipit velit vitae voluptatem.</span></p>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-lg-12">
                                                                    <span id="proposal_message_display"class="form-label-description"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        </span>
                                    </div>
                                    <!-- END PROPOSAL INFO -->                
                                    </td>
                                </tr>
                                <tr>
                                    <td style="vertical-align:top">
                                        <span id="proposal_section_display"> 
                                            <div class="col-md-3 col-lg-12">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h3 class="card-title">Section Title</h3>
                                                        <p class="text-muted">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aperiam deleniti fugit incidunt, iste, itaque minima neque pariatur perferendis sed suscipit velit vitae voluptatem.</p>
                                                    </div>
                                                    <!-- Card footer -->
                                                    <div class="card-footer">
                                                        <div class="d-flex">                                                                                
                                                            <span id="vote_cost" class="mt-3 badge bg-cyan ms-auto mt-2 d-flex">Vote Cost: 1 USDC</span>
                                                            <span id="vote_cycle_time_remaining" class="mt-3 badge bg-danger ms-auto mt-2 d-flex">Time Remaining: 10 mins</span>

                                                            <a href="#" class="btn btn-warning ms-auto">Approve</a>
                                                            <a href="#" class="btn btn-danger ms-auto" data-bs-toggle="modal" data-bs-target="#modal-vote">Vote</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-3 col-lg-12">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h3 class="card-title">Section Title</h3>
                                                        <p class="text-muted">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aperiam deleniti fugit incidunt, iste, itaque minima neque pariatur perferendis sed suscipit velit vitae voluptatem.</p>
                                                    </div>
                                                    <!-- Card footer -->
                                                    <div class="card-footer">
                                                        <div class="d-flex">
                                                            <span id="vote_cost" class="mt-3 badge bg-cyan ms-auto mt-2 d-flex">Vote Cost: 1 USDC</span>
                                                            <span id="vote_cycle_time_remaining" class="mt-3 badge bg-warning ms-auto mt-2 d-flex">Time Remaining: 20 mins</span>

                                                            <a href="#" class="btn btn-warning ms-auto">Approve</a>
                                                            <a href="#" class="btn btn-danger ms-auto" data-bs-toggle="modal" data-bs-target="#modal-vote">Vote</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-md-3 col-lg-12">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <h3 class="card-title">Section Title</h3>
                                                        <p class="text-muted">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aperiam deleniti fugit incidunt, iste, itaque minima neque pariatur perferendis sed suscipit velit vitae voluptatem.</p>
                                                    </div>
                                                    <!-- Card footer -->
                                                    <div class="card-footer">
                                                        <div class="d-flex">

                                                            <table>
                                                                <tr>
                                                                    <td>Author</td>
                                                                    <td><b>Total Vote Funding:</b></td>
                                                                    <td>Total Votes Cast</td>
                                                                    <td>Votes For</td>
                                                                    <td>Votes Against</td>
                                                                    <td><b>Vote Result</b></td>
                                                                </tr>
                                                                <tr>
                                                                    <td><span id="section_author" class="mt-3 badge">0xEEB35AC9A858C4CF83A301E791705A0849A7FD8F</span></td>
                                                                    <td><span id="vote_cost" class="mt-3 badge bg-orange"> 10 USDC</span></td>
                                                                    <td><span id="vote_cost" class="mt-3 badge bg-orange"> 5</span></td>
                                                                    <td><span id="vote_for" class="mt-3 badge bg-green-lt">3</span></td>
                                                                    <td><span id="vote_for" class="mt-3 badge bg-pink-lt">2</span></td>
                                                                    <td><span id="vote_cycle_time_remaining" class="mt-3 badge bg-success">Accepted</span></td>
                                                                </tr>
                                                            </table>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <footer class="footer footer-transparent d-print-none">
                    <div class="container-xl">
                        <div class="row text-center align-items-center flex-row-reverse">
                            <div class="col-lg-auto ms-lg-auto">
                            </div>
                            <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                                <ul class="list-inline list-inline-dots mb-0">
                                    <li class="list-inline-item">
                                        Copyright &copy; 2022
                                        <a href="https://www.blockstarlogic.com" class="link-secondary">Block 	
                                    <font color="red">&#9733;</font> Logic</a>.
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>

    <!-- Start Modals -->
 

    <!-- Vote Modal -->
    <div class="modal modal-blur fade" id="modal-vote" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Vote</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h4>Vote Comment</h4>
                    <textarea class="form-control" id="vote_comment" name="example-textarea-input" rows="6" placeholder="enter vote comment ..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="up_vote_button" class="btn btn-warning" data-bs-dismiss="modal">Up Vote</button>
                    <button type="button" id="down_vote_button" class="btn btn-danger" data-bs-dismiss="modal">Down Vote</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Section Modal -->
    <div class="modal modal-blur fade" id="modal-section" tabindex="-1" role="dialog" aria-hidden="true">      
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Draft Section</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row"> 
                        <div class="col-lg-12">
                            <label class="form-label">Section Cost : </label><span id="add_section_cost_display"></span>&nbsp;<span id="add_section_cost_currency_symbol_display"></span> 
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Section Title</label>
                        <input id="section_title_field" type="text" class="form-control" name="example-text-input" placeholder="..enter section title">
                    </div>
                    <div class="mb-12">
                        <label class="form-label">Section Content</label>
                        <textarea id="section_content_field" type="text" class="form-control" name="example-text-input" placeholder="..enter section content"></textarea>
                    </div> 
                    <div class="row"> 
                        <span id="draft_section_message"></span>
                    </div>                                                 
                </div>
                <div class="modal-footer">
                    <a href="javascript:clearSectionEntry()" class="btn btn-link link-secondary" data-bs-dismiss="modal">Cancel</a>               
                    <div class="mt-2 d-flex">                       
                        <span id="add_section_approve_button_display"></span>
                        <span id="add_section_button_display"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Proposal Modal -->
    <div class="modal modal-blur fade" id="modal-report" tabindex="-1" role="dialog" aria-hidden="true">      
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Draft Proposal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">DAO</label>
                        <input id="dao_name_field" type="text" class="form-control" name="example-text-input" placeholder="..enter DAO name">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">DAO Proposal Name</label>
                        <input id="proposal_name_field" type="text" class="form-control" name="example-text-input" placeholder="..enter DAO proposal name">
                    </div>

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="col-lg-6">
                                <div class="mb-6">
                                    <label class="form-label">Proposal Owner Name</label>
                                    <input id="proposal_owner_name_field" type="text" placeholder="...enter your name" class="form-control">
                                    <br/>
                                    <span id="proposal_creating_account"></span>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Proposal Image</label>
                                <input id="proposal_image_field" type="file" class="form-control" />
                            </div>
                        </div>

                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Background Data url</label>
                                <div class="input-group input-group-flat">
                                    <input id="background_data_url_field" type="text" class="form-control ps-0" placeholder="...enter link to any background data" autocomplete="off">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Target Submission Date</label>
                                <input id="target_submission_date_field" type="date" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Proposal Currency</label>
                                <div class="input-group input-group-flat">
                                    <input id="proposal_currency_field" type="text" class="form-control ps-0" value="0x3E1Da782E575889F1675eb59aF8396232716B5Ce" autocomplete="off">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Proposal Section Creation Fee</label>
                                <input id="proposal_section_creation_fee_field" type="text" class="form-control ps-0" autocomplete="off" />
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Proposal Section Vote Cycle Time</label>
                                <select id="proposal_section_vote_cycle_time_field" class="form-select">
                                    <option value="1">1 mins</option>
                                    <option value="15">15 mins</option>
                                    <option value="30">30 mins</option>
                                    <option value="60" selected>1 hr</option>
                                    <option value="120">2 hr</option>
                                    <option value="720" >6 hr</option>
                                    <option value="1440" >12 hr</option>
                                    <option value="2880" >24 hr</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Voting Fee</label>
                                <input id="vote_fee_field" type="text" class="form-control ps-0" autocomplete="off" />
                            </div>
                        </div>

                        <div class="col-lg-12">
                            <div>
                                <label class="form-label">Additional Information</label>
                                <textarea id="additional_information" class="form-control" rows="3"></textarea>
                            </div>

                        </div>
                        <div class="col-lg-4">
                            <div class="mb-4">
                                <label class="form-label">Proposal Creation Fee</label>
                                <span id="proposal_creation_fee_span"></span>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="mb-4">
                                <label class="form-label">Token Contract</label>
                                <span id="proposal_creation_fee_token_contract_span"></span>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="mb-4">
                                <a href="#" id="approve_proposal_creation_spend_button" class="btn btn-primary">Approve Design Proposal</a>
                                <br/><small>Approve Design Proposal to spend your currency</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-link link-secondary" data-bs-dismiss="modal">Cancel</a>
                    <a href="javascript:createDraftProposal();" onclick="createDraftProposal()" id="create_draft_proposal_button" class="btn btn-primary ms-auto" data-bs-dismiss="modal">
                        <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>                        Create Draft Proposal
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- Libs JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.2/masonry.pkgd.min.js" defer></script>
    <!-- Tabler Core -->
    <script src="./dist/js/tabler.min.js" defer></script>
    <script src="./dist/js/demo.min.js" defer></script>


    <!-- IERC20 -->
    <script src="abi/i_erc20_metadata_abi.js"></script>

    <!-- Open Block EI Integration -->
    <script src="abi/i_open_register_abi.js"></script>

    <!-- Design Proposal Contracts -->
    <script src="abi/i_design_proposal_abi.js"></script>
    <script src="abi/i_proposal_abi.js"></script>
    <script src="abi/i_section_abi.js"></script>

    <script src="js/autoconnect.js"></script>

    <script>
        // proposal manage
        const proposalListTable = ge("proposal_list_table");

        // proposal create
        const daoNameField = ge("dao_name_field");
        const proposalNameField = ge("proposal_name_field");
        const proposalOwnerField = ge("proposal_owner_name_field");
        const creatingAccountSpan = ge("proposal_creating_account"); // set to connected account
        const proposalImageField = ge("proposal_image_field");
        const backgroundDataField = ge("background_data_url_field");
        const targetSubmissionDateField = ge("target_submission_date_field");

        const proposalCurrencyField = ge("proposal_currency_field"); // set default 0x3E1Da782E575889F1675eb59aF8396232716B5Ce       
        const proposalSectionCreationFee = ge("proposal_section_creation_fee_field");
        const pproposalVoteCycleTimeField = ge("proposal_section_vote_cycle_time_field");
        const voteFeeField = ge("vote_fee_field");

        const additionalInformation = ge("additional_information");

        const proposalCreationFeeSpan = ge("proposal_creation_fee_span");
        const proposalCreationFeeTokenContractSpan = ge("proposal_creation_fee_token_contract_span");
        const approveProposalCreationSpendButton = ge("approve_proposal_creation_spend_button");
        const createReportButton                = ge("create_draft_proposal_button");

        const displayProposalCreateHash         = ge("proposal_create_hash_display");

        // proposal display
        const proposalImageDisplay              = ge("proposal_image_display");
        const proposalStatusDisplay             = ge("proposal_status_display");
        const proposalTitleSpan                 = ge("proposal_title_display");
        const proposalDAODisplay                = ge("proposal_dao_display");
        const backgroundDataDisplay             = ge("background_data_url_display");
        const proposalOwnerNameDisplay          = ge("proposal_owner_name_display");
        const proposalOwnerAddressDisplay       = ge("proposal_owner_address_display");
        const proposalCurrencyDisplay           = ge("proposal_currency_display");
        const proposalSectionMessage           = ge("");

        const targetSubmissionDateDisplay       = ge("target_submission_date_display");

        const sectionCreationFeeDisplay         = ge("section_creation_fee_span");
        const sectionVoteCycleTimeDisplay       = ge("section_vote_cycle_time_display");
        const sectionVoteFeeDisplay             = ge("section_vote_fee_span");

        const additionalInformationDisplay      = ge("additional_information_display");
        const withdrawProposalButtonDisplay     = ge("withdraw_proposal_button_display");
        const addProposalSectionButtonDisplay   = ge("add_proposal_section_button_display");
        // proposal end 

        // add section modal 
        const sectionTitleField                     = ge("section_title_field");
        const sectionContentField                   = ge("section_content_field");
        const addSectionCostDisplay                 = ge("add_section_cost_display");
        const addSectionCostCurrencyDisplaySymbol   = ge("add_section_cost_currency_symbol_display");        
        const addSectionApproveButtonDisplay        = ge("add_section_approve_button_display");
        const addSectionButtonDisplay               = ge("add_section_button_display");
        const draftSectionMessage                   = ge("draft_section_message");
        // end modal 

        const proposalMessageDisplay          = ge("proposal_message_display");
        const sectionDisplay                 = ge("proposal_section_display");
     



        const ipfsRoot = "https://designproposal.infura-ipfs.io/ipfs/";

        const iOpenRegisterAddress = "0x25661cca52F1Df6D143411E8216a79555de12F1E";
        const iOpenRegisterContract = new web3.eth.Contract(iOpenRegisterAbi, iOpenRegisterAddress);

        var iDesignProposalAddress;
        var iDesignProposalContract;

        var selectedProposalAddress;
        var selectedProposalContract;

       async function configureCoreContracts() {
            iOpenRegisterContract.methods.getAddress("RESERVED_DESIGN_PROPOSAL_CORE").call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    iDesignProposalAddress = response;
                    iDesignProposalContract = getContract(iDesignProposalAbi, iDesignProposalAddress);
                    console.log(iDesignProposalContract);
                    return iDesignProposalContract;
                })
                .catch(function(err) {
                    console.log(err);
                })
        }

        function loadPageData() {
            console.log("loading page data");
            console.log(iDesignProposalContract);
            getCurrentProposals();
        }

        function clearCurrentProposals(){
            proposalListTable.tBodies[0].innerHtml = "";
        }

        function getCurrentProposals() {

            iDesignProposalContract.methods.getProposals().call({
                    from: account
                })
                .then(function(response) {
                    console.log("design proposal response");
                    console.log(response);
                    console.log(proposalListTable.tBodies[0]);
                    clearCurrentProposals();

                    var proposalAddresses = response;
                    if (proposalAddresses.length < 1) {
                        var row = proposalListTable.tBodies[0].insertRow();
                        var cell = row.insertCell();
                        cell.setAttribute("colspan", 4);
                        var center = ce("center");
                        center.append(text("NO PROPOSALS AVAILABLE"));
                        cell.appendChild(center);
                        return;
                    }
                    console.log("loading proposalas ");
                    for (var x = 0; x < proposalAddresses.length; x++) {
                        var proposalAddress = proposalAddresses[x];
                        console.log("proposal : " + proposalAddress);
                        addDisplayRow(proposalAddress);
                    }
                })
                .catch(function(err) {
                    console.log(err);
                })
        }

        function setImageDisplay(iProposalContract, display) {
            iProposalContract.methods.getPropertyIPFS("PROPOSAL_IMAGE_IPFS_KEY").call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    display.setAttribute("style", "background-image: url(" + ipfsRoot + response + ")");
                })
                .catch(function(err) {
                    console.log(err);
                });
        }

        function setImageDisplayInnerHTML(iProposalContract, display) {
            iProposalContract.methods.getPropertyIPFS("PROPOSAL_IMAGE_IPFS_KEY").call({
                from: account
            })
            .then(function(response) {
                console.log(response);
                display.innerHTML = "<img src='" + ipfsRoot + response + "' class=\"w-75 h-75\" alt=\"\">";
            })
            .catch(function(err) {
                console.log(err);
            });
        }

        async function approveSection(address, cost) {
            console.log("cost : " + cost);
            draftSectionMessage.innerHTML = await approve(address, cost);
        }

        async function approveVote(address, cost) {
            console.log("cost : " + cost);
            voteMessage.innerHTML = await approve(address, cost);
        }

        function appendSymbol(erc20Address, node)  {
            iErc20 = getContract(iERC20MetadataAbi, erc20Address);
            iErc20.methods.symbol().call({from : account})
            .then(function(response){
                console.log(response);
                node.append(response);
            })
            .catch(function(err) {
                console.log(err);
            });
        }
        

        function setSectionCostDisplay(fee){
            addSectionCostDisplay.innerHTML = ""
            addSectionCostDisplay.append(text(fee + " "));
        }

        function setSectionCostSymbolDisplay(symbol) {
            addSectionCostCurrencyDisplaySymbol.append(text(symbol));
        }

        function setSectionCostApprove(address, cost) {
            addSectionApproveButtonDisplay.innerHTML = "<a id=\"add_section_approve_button\" href=\"javascript:approveSection('"+address+"',"+cost+")\" class=\"btn btn-warning ms-auto\">Approve Design Proposal</a> &nbsp;";
        }

        function setAddSectionButtonDisplay(proposalAddress){               
            addSectionButtonDisplay.innerHTML = "<a id=\"add_section_button\" href=\"#\" onclick=\"addSection('"+proposalAddress+"')\" class=\"btn btn-danger ms-auto\" data-bs-dismiss=\"modal\">Add Section</a>"; 
        }


        function addDisplayRow(proposalAddress) {

            var iProposalContract = new web3.eth.Contract(iProposalAbi, proposalAddress);

            var row = proposalListTable.tBodies[0].insertRow();

            var a = ce("a");
            a.setAttribute("href", "javascript:displayProposal('" + proposalAddress + "')");

            var imageCell = row.insertCell();
            addClassToElement(imageCell, "w-1");
            var imageSpan = ce("span");
            addClassToElement(imageSpan, "avatar avatar-sm");
            a.append(imageSpan);
            imageCell.append(a);
            setImageDisplay(iProposalContract, imageSpan);

            var daoCell = row.insertCell(); 
            iProposalContract.methods.getPropertyIPFS("PROPOSAL_INFO_IPFS_KEY").call({from : account})
            .then(function(response){
                console.log(response);
                setDAO(response, daoCell);
            })
            .catch(function(err) {
                console.log(err);
            });

            var b = ce("a");
            b.setAttribute("href", "javascript:displayProposal('" + proposalAddress + "')");

            var titleCell = row.insertCell();
            addClassToElement(titleCell, "td");
            var di = ce("div");
            di.setAttribute("class", "text");



            iProposalContract.methods.getTitle().call({
                from: account
            })
            .then(function(response) {
                console.log(response);
                b.appendChild(text(response));
                di.appendChild(b);
                titleCell.append(di);
            })
            .catch(function(err) {
                console.log(err);
            });

            var statusCell = row.insertCell();

            iProposalContract.methods.getStatus().call({from : account})
            .then(function(response){
                console.log(response);
                statusCell.append(text(response));
            })
            .catch(function(err) {
                console.log(err);
            }); 

            var targetSubmitDateCell = row.insertCell();
            addClassToElement(targetSubmitDateCell, "text-nowrap text-muted");
            iProposalContract.methods.getTargetSubmissionDate().call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    targetSubmitDateCell.append(text(formatDate(new Date(response * 1000))));
                })
                .catch(function(err) {
                    console.log(err);
                });
        }

        var arrived = false;

        function formatTimeForBlockchain(d) {
            var v = d/1000;
            console.log(v);
            return BigInt(v);
        }

        function createDraftProposal() {
            var ipfsPropertyNames = ["PROPOSAL_INFO_IPFS_KEY", "PROPOSAL_IMAGE_IPFS_KEY"];
            let ipfsPropertyValues = new Array(2);

            var uintPropertyNames = ["VOTE_CYCLE_TIME_KEY", "VOTE_FEE_KEY", "SECTION_FEE_KEY"];
            var uintPropertyValues = new Array(3);
            uintPropertyValues[0] =  BigInt(pproposalVoteCycleTimeField.value * 60);
            uintPropertyValues[1] = BigInt(voteFeeField.value);
            uintPropertyValues[2] = BigInt(proposalSectionCreationFee.value);

            var dao = daoNameField.value;
            var owner = account;
            var title = proposalNameField.value;
            var backgroundDataLink = backgroundDataField.value;
            var currencyAddress = proposalCurrencyField.value;
            var t = new Date(targetSubmissionDateField.value).getTime();
            var targetSubmissionDate = formatTimeForBlockchain(t);
            console.log(targetSubmissionDate);

            var proposalInfo = {};
            proposalInfo.dao = dao;
            proposalInfo.ownerName = proposalOwnerField.value;
            proposalInfo.proposalTitle = title;
            proposalInfo.additionalInfo = additionalInformation.value;
            proposalInfo.creationDate = new Date().getTime();

            ipfs.add(JSON.stringify(proposalInfo))
                .then(function(response) {
                    console.log(response);
                    ipfsPropertyValues[0] = response[0].hash;

                    ipfs.add(proposalImageField.files[0])
                        .then(function(response) {
                            console.log(response);
                            ipfsPropertyValues[1] = response[0].hash;

                            console.log(dao);
                            console.log(owner);
                            console.log(title);
                            console.log(targetSubmissionDate);
                            console.log(backgroundDataLink);
                            console.log(currencyAddress);
                            console.log(ipfsPropertyNames);
                            console.log(ipfsPropertyValues);
                            console.log(uintPropertyNames);
                            console.log(uintPropertyValues);


                            create(dao, owner,
                                title,
                                targetSubmissionDate ,
                                backgroundDataLink, currencyAddress,
                                ipfsPropertyNames, ipfsPropertyValues,
                                uintPropertyNames, uintPropertyValues);
                        })
                        .catch(function(err) {
                            console.log(err);
                        });

                })
                .catch(function(err) {
                    console.log(err);
                });
        }

        function create(dao, 
            owner,
            title,
            targetSubmissionDate,
            backgroundDataLink,
            currencyAddress,
            ipfsPropertyNames,
            ipfsPropertyValues,
            uintPropertyNames,
            uintPropertyValues) {
                
            console.log(iDesignProposalContract);

            iDesignProposalContract.methods.createProposal(dao, owner,
                    title,
                    targetSubmissionDate,
                    backgroundDataLink,
                    currencyAddress,
                    ipfsPropertyNames,
                    ipfsPropertyValues,
                    uintPropertyNames,
                    uintPropertyValues).send({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    displayProposalCreateHash.innerHTML = "PROPOSAL CREATED: " + response.blockHash;                    
                    getCurrentProposals();
                })
                .catch(function(err) {
                    console.log(err);
                })

        }

        function withdrawProposal(proposalAddress) {

        }

        function withdrawSection(sectionAddress) {

        }

        function addClassToElement(cell, cls) {
            cell.setAttribute("class", cls);
        }

        function displayProposal(proposalAddress) {

            console.log("proposal address : " + proposalAddress);
            selectedProposalContract = new web3.eth.Contract(iProposalAbi, proposalAddress);
            setImageDisplayInnerHTML(selectedProposalContract, proposalImageDisplay);

            withdrawProposalButtonDisplay.innerHTML = "<a href=\"javascript:withdrawProposal('" + proposalAddress + "')\" class=\"btn btn-danger\">Withdraw Proposal</a>";
            addProposalSectionButtonDisplay.innerHTML = "<a href=\"#\" data-bs-toggle=\"modal\" data-bs-target=\"#modal-section\" class=\"btn btn-warning\">Add Section</a>"; 

            setAddSectionButtonDisplay(proposalAddress);

            selectedProposalContract.methods.getTitle().call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    proposalTitleSpan.innerHTML = response;
                })
                .catch(function(err) {
                    console.log(err);
                });

            selectedProposalContract.methods.getStatus().call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    proposalStatusDisplay.innerHTML = response;
                })
                .catch(function(err) {
                    console.log(err);
                });

            selectedProposalContract.methods.getTargetSubmissionDate().call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    targetSubmissionDateDisplay.innerHTML = formatDate(new Date(response * 1000));
                })
                .catch(function(err) {
                    console.log(err);
                });

            selectedProposalContract.methods.getOwner().call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    proposalOwnerAddressDisplay.innerHTML = response;
                })
                .catch(function(err) {
                    console.log(err);
                });

            selectedProposalContract.methods.getBackgroundDataLink().call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    backgroundDataDisplay.innerHTML = response;
                })
                .catch(function(err) {
                    console.log(err);
                });

            selectedProposalContract.methods.getCurrencyAddress().call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    var proposalCurrencyAddress = response; 
                    var erc20Metadata = new web3.eth.Contract(iERC20MetadataAbi, proposalCurrencyAddress);
                    erc20Metadata.methods.symbol().call({
                            from: account
                        })
                        .then(function(response) {
                            var symbol = response;
                            console.log("called symbol");
                            console.log(response);
                            setSectionCostSymbolDisplay(symbol);
                            proposalCurrencyDisplay.innerHTML = symbol;
                            erc20Metadata.methods.decimals().call({
                                    from: account
                                })
                                .then(function(response) {
                                    console.log(response);
                                    var decimals = Number("1e" + response);

                                    // vote fee
                                    selectedProposalContract.methods.getPropertyUINT("VOTE_FEE_KEY").call({
                                            from: account
                                        })
                                        .then(function(response) {
                                            console.log(response);
                                            var rawVoteFee = response; 
                                            var displayVoteFee = (response / decimals)
                                            sectionVoteFeeDisplay.innerHTML = displayVoteFee + " " + symbol;
                                        })
                                        .catch(function(err) {
                                            console.log(err);
                                        });

                                    // section fee
                                    selectedProposalContract.methods.getPropertyUINT("SECTION_FEE_KEY").call({
                                            from: account
                                        })
                                        .then(function(response) {
                                            console.log(response);
                                            console.log("raw section fee : " + response);
                                            var rawSectionFee = response; 
                                            var displaySectionFee = (response / decimals);
                                            sectionCreationFeeDisplay.innerHTML = "";
                                            sectionCreationFeeDisplay.innerHTML = displaySectionFee + " " + symbol;
                                            setSectionCostDisplay(displaySectionFee);
                                            setSectionCostApprove(proposalCurrencyAddress, rawSectionFee)
                                        })
                                        .catch(function(err) {
                                            console.log(err);
                                        });
                                })
                                .catch(function(err) {
                                    console.log(err);
                                });
                        })
                        .catch(function(err) {
                            console.log(err);
                        });
                })
                .catch(function(err) {
                    console.log(err);
                });

            selectedProposalContract.methods.getPropertyIPFS("PROPOSAL_INFO_IPFS_KEY").call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    populateIPFSSourcedData(response);
                })
                .catch(function(err) {
                    console.log(err);
                });

            selectedProposalContract.methods.getPropertyUINT("VOTE_CYCLE_TIME_KEY").call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    sectionVoteCycleTimeDisplay.innerHTML = (response / 60) + " mins";
                })
                .catch(function(err) {
                    console.log(err);
                });
            // load sections
            loadProposalSections(selectedProposalContract, proposalAddress);
        }

        function setDAO(ipfsHash, node) {
            console.log(" hash : " + ipfsHash);
            fetch(ipfsRoot + ipfsHash)
            .then(function(response) {
                console.log(response);
                response.json()
                    .then(function(response) {
                        console.log(response);
                        var data = response;
                        node.innerHTML = ""; 
                        node.append(text(data.dao));
                    })
            })
            .catch(function(err) {
                console.log(err);
            });  
        }

        function populateIPFSSourcedData(ipfsHash) {
            console.log(" hash : " + ipfsHash);
            fetch(ipfsRoot + ipfsHash)
                .then(function(response) {
                    console.log(response);
                    response.json()
                        .then(function(response) {
                            console.log(response);
                            var data = response;
                            additionalInformationDisplay.innerHTML = data.additionalInfo;
                            proposalOwnerNameDisplay.innerHTML = data.ownerName;
                            proposalDAODisplay.innerHTML = data.dao;
                        })
                })
                .catch(function(err) {
                    console.log(err);
                });
        }

    

        function clearSectionEntry() {
            sectionTitleField.value = "";
            sectionContentField.value = "";
        }



        function addSection(proposalAddress) {                        
            console.log("proposal : " + proposalAddress);
            ipfs.add(sectionContentField.value)
                .then(function(response) {
                    console.log("ipfs section hash : " + response);
                    console.log(response);
                    var ipfsHash = response[0].hash;

                    console.log(iProposalAbi);

                    iProposalContract = getContract(iProposalAbi, proposalAddress);
                    console.log(iProposalContract);
                    console.log(sectionTitleField.value)
                    console.log(ipfsHash);
                    iProposalContract.methods.addSection(sectionTitleField.value, ipfsHash).send({
                            from: account
                        })
                        .then(function(response) {
                            console.log(response);
                            // clear section entry 
                            clearSectionEntry();
                            // reload sections 
                            loadProposalSections(iProposalContract, proposalAddress);
                            // mintSectionNFT(mintAddress, user, proposalSectionContent.value, proposalSectionTitle.value);
                            proposalMessageDisplay.innerHTML = ""; 
                            proposalMessageDisplay.innerHTML = response.blockHash + " ipfs hash : " + ipfsHash ;
                            
                        })
                        .catch(function(err) {
                            console.log(err);
                        });
                })
                .catch(function(err) {
                    console.log(err);
                });            
        }

        function loadProposalSections(selectedProposalContract,proposalAddress) {
            sectionDisplay.innerHTML = "";
            selectedProposalContract.methods.getSections().call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    var sections = response;
                    if (sections.length < 1) {
                        sectionDisplay.innerHTML = "<center><b>NO SECTIONS TO DISPLAY - ADD SECTION TO BEGIN</b></center>";
                        return;
                    }

                    selectedProposalContract.methods.getFee("VOTE_FEE_KEY").call({from : account})
                    .then(function(response){
                        console.log(response)
                        var voteFee = response; 
                        selectedProposalContract.methods.getCurrencyAddress().call({ from : account})
                        .then(function(response){
                            console.log(response);
                            proposalCurrencyAddress = response; 


                            for (var x = 0; x < sections.length; x++) {
                                var section = sections[x];
                                displaySection(section, proposalAddress, proposalCurrencyAddress, voteFee);
                            }
                        })
                        .catch(function(err) {
                            console.log(err);
                        });
                    })
                    .catch(function(err) {
                        console.log(err);
                    });


                })
                .catch(function(err) {
                    console.log(err);
                });
        }

        function displaySection(sectionAddress, proposalAddress, proposalCurrencyAddress, voteFee) {
            iSectionContract = new web3.eth.Contract(iSectionAbi, sectionAddress);

            var holder = ce("div");
            holder.setAttribute("class", "col-md-3 col-lg-12");
            sectionDisplay.append(holder);

            var card = ce("div");
            card.setAttribute("class", "card");
            holder.append(card);

            var cardBody = ce("div");
            cardBody.setAttribute("class", "card-body");
            card.append(cardBody);

            var h3 = ce("h3");
            h3.setAttribute("class", "card-title");
            iSectionContract.methods.getTitle().call({
                    from: account
                }) // remember to redeploy contracts 
                .then(function(response) {
                    console.log(response);
                    h3.append(text(response));
                    cardBody.append(h3);
                })
                .catch(function(err) {
                    console.log(err);
                });

            var p = ce("p");
            p.setAttribute("class", "text-muted");
            iSectionContract.methods.getContent().call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);
                    var ipfsHash = response;
                    fetch(ipfsRoot + ipfsHash)
                        .then(function(response) {
                            console.log(response);      
                            response.text()
                            .then(function(response){
                                var y = response; 
                                console.log(y);
                                p.appendChild(text(y));
                                cardBody.append(p);
                            })               
                           
                        })
                        .catch(function(err) {
                            console.log(err);
                        });

                })
                .catch(function(err) {
                    console.log(err);
                });


            var cardFooter = ce("div");
            cardFooter.setAttribute("class", "card-footer");
            card.append(cardFooter);

            var cardFooterHolder = ce("div");
            cardFooterHolder.setAttribute("class", "d-flex");
            cardFooter.append(cardFooterHolder);

            var voteCycleTimeRemaining = ce("span");
            voteCycleTimeRemaining.setAttribute("class", "mt-3 badge bg-danger ms-auto mt-2 d-flex");
            iSectionContract.methods.getCycleTimeRemaining().call({
                    from: account
                })
                .then(function(response) {
                    console.log(response);  
                    var t = response;                   
                    var timeRemaining = formatTimeRemaining(response);
                    if(t > 0){
                        getTimeRemainingButtonClass(proposalAddress, iSectionContract, voteCycleTimeRemaining);
                        voteCycleTimeRemaining.append(text("Time Remaining : " + timeRemaining));                        
                        cardFooterHolder.append(voteCycleTimeRemaining);                        
                        var span =  setVoteCostSpan(proposalCurrencyAddress, voteFee,  cardFooterHolder);                    
                        appendSymbol(proposalCurrencyAddress, span);
                        setSectionVoteApproveButton(proposalCurrencyAddress, sectionAddress, voteFee, cardFooterHolder);            
                        setModalVoteButton(cardFooterHolder, sectionAddress);
                    }
                    else { 
                        displayVoteResult(iSectionContract, cardFooterHolder);                                                
                    }
                })
                .catch(function(err) {
                    console.log(err);
                });                              
        }

        function setVoteCostSpan(currencyAddress, voteFee, cardFooterHolder){            
            var voteCostSpan = ce("span");
            formatCurrencyDecimals(currencyAddress, voteFee, voteCostSpan);
            voteCostSpan.setAttribute("class", "mt-3 badge bg-cyan ms-auto mt-2 d-flex");            
            cardFooterHolder.append(voteCostSpan);
            return voteCostSpan; 
        }
        async function formatCurrencyDecimals(currencyAddress, v, span){
            var iErc20 = getContract(iERC20MetadataAbi, currencyAddress); 
            var formated = await iErc20.methods.decimals().call({from : account})
            .then(function(response){
                console.log(response);
                var factor = Number("1e"+response);
                console.log(factor);     
                var result = (v / factor); 
                span.appendChild(text(result + " "));
            })
            .catch(function(err){
                console.log(err);
            });
            return formated; 

        }

        function addHeader(header, value) {
            var cell = header.insertCell();
            var b = ce("b") ;
            b.append(text(value))
            cell.appendChild(b);
        }

        function displayVoteResult(iSectionContract, cardFooterHolder) {

            var table = ce("table");
            table.setAttribute("style", "padding : 15px");
            table.setAttribute("width","100%");
            cardFooterHolder.append(table);
            var header = table.insertRow(); 
            addHeader(header, "Originator");
            addHeader(header, "Total Votes Cast");
            addHeader(header, "Votes For");
            addHeader(header, "Votes Against");
            addHeader(header, "Vote Result");
            addHeader(header, "Section Status");
           
            var row = table.insertRow();
            
            var originatorCell = row.insertCell(); 
            var totalVotesCell = row.insertCell(); 

            iSectionContract.methods.getOriginator().call({from : account})
            .then(function(response){
                console.log(response);
                var os = ce("span");
                os.setAttribute("class", "mt-3 badge bg-primary-lt");
                os.append(text(response));
                originatorCell.append(os);
            })
            .catch(function(err) {
                console.log(err);
            });


            

            iSectionContract.methods.getVotes().call({from : account})
            .then(function(response){
                console.log(response);
                var votes = response; 
                var totalVotesSpan = ce("span");
                var c = ce("center");
                c.append(text(votes.length));
                totalVotesSpan.append(c); 
                totalVotesCell.append(totalVotesSpan);
                if(votes.length > 0) {
                    totalVotesSpan.setAttribute("class", "mt-3 badge bg-primary-lt");
                    var upvoteCount = 0; 
                    for(var x = 0; x < votes.length; x++) {
                        var vote = votes[x];
                        if(vote.upVote) {
                            upvoteCount++;
                        }
                    }
                    var totalVotesForCell = row.insertCell();             
          
                    var greenSpan = ce("span");
                    greenSpan.setAttribute("class", "mt-3 badge bg-green-lt");
                    greenSpan.append(text(upvoteCount));
                    
                    totalVotesForCell.append(greenSpan);

                    var totalVotesAgainstCell = row.insertCell(); 
                    var redSpan = ce("span");
                    redSpan.setAttribute("class","mt-3 badge bg-pink-lt");
                    redspan.append(text(votes.length - upvoteCount));
                    
                    totalVotesAgainstCell.append(redSpan);
                }
                else { 
                    totalVotesSpan.setAttribute("class", "mt-3 badge bg-black-lt");
                    var noVotesCell = row.insertCell();
                    noVotesCell.setAttribute("colspan","2");
                    var cv = ce("center");
                    cv.setAttribute("class","mt-3 badge bg-dark-lt");
                    cv.append(text("NO VOTES CAST"));
                    noVotesCell.append(cv);
                }

                var resultCell = row.insertCell();
                iSectionContract.methods.getVoteResult().call({from : account})
                .then(function(response){
                    console.log(response)
                    var result = response;
                    var resultSpan = ce("span");
                    resultCell.append(resultSpan);
                    if(result === "ACCEPTED")  {
                        resultSpan.setAttribute("class", "mt-3 badge bg-success");
                        resultSpan.append(text(result));                    
                    }
                    else{ 
                        resultSpan.setAttribute("class", "mt-3 badge bg-danger");
                        resultSpan.append(text(result)); 
                    }
                })
                .catch(function(err) {
                    console.log(err);
                });

                var statusCell = row.insertCell(); 
                iSectionContract.methods.getStatus().call({from : account})
                .then(function(response){
                    console.log(response);
                    var status = response; 
                    var ss = ce("span");
                    ss.append(text(status));
                    var badge = ""; 
                    if(status === "WITHDRAWN"){
                        badge = "mt-3 badge bg-dark"
                    }
                    if(status === "OPEN"){
                        badge = "mt-3 badge bg-green-lt"

                    }
                    if(status === "CLOSED"){
                        badge = "mt-3 badge bg-pink-lt"
                    }

                    ss.setAttribute("class", badge);
                    statusCell.append(ss);
                })
                .catch(function(err) {
                    console.log(err);
                });



                })
                .catch(function(err) {
                    console.log(err);
                });
        }


        function setSectionVoteApproveButton(proposalCurrencyAddress, sectionAddress, voteFee, cardFooterHolder) {
            var approveButton = ce("a");
            approveButton.setAttribute("href", "javascript:approve('" + proposalCurrencyAddress + "','"+sectionAddress+"'," + voteFee + ")");
            approveButton.setAttribute("class", "btn btn-warning ms-auto");
            approveButton.append(text("Approve Section To Vote"));
            cardFooterHolder.append(approveButton); 
        }

        function setModalVoteButton(cardFooterHolder, sectionAddress) {
            var voteButton = ce("a");
            voteButton.setAttribute("href", "#");
            voteButton.setAttribute("class", "btn btn-danger ms-auto");
            voteButton.setAttribute("data-bs-toggle", "modal");
            voteButton.setAttribute("data-bs-target", "#modal-vote");
            voteButton.setAttribute("onclick", "setVoteModal('"+sectionAddress+"')");
            voteButton.appendChild(text("Vote"));
            cardFooterHolder.append(voteButton);
        }


        function getTimeRemainingButtonClass(proposalAddress, iSectionContract, voteCycleTimeRemaining){
            iProposalContract = getContract(iProposalAbi, proposalAddress);
            iProposalContract.methods.getPropertyUINT("VOTE_CYCLE_TIME_KEY").call({from : account})
            .then(function(response){
                console.log(response);
                var voteCycleTime = response; 
                iSectionContract.methods.getCycleTimeRemaining().call({ from : account})
                .then(function(response){
                    console.log(response)
                    var buttonClass = "btn btn-primary";
                    var timeRemaining = response; 
                    if((timeRemaining / voteCycleTime) > 0.7){
                        buttonClass = "btn btn-success";
                    }
                    if((timeRemaining / voteCycleTime) < 0.7){
                        buttonClass = "btn btn-warning";
                    }
                    if((timeRemaining / voteCycleTime) < 0.3){
                        buttonClass = "btn btn-danger";
                    }   
                    voteCycleTimeRemaining.setAttribute("class", buttonClass);
                })                
                .catch(function(err) {
                    console.log(err);
                });
                
            })
            .catch(function(err) {
                console.log(err);
            });
        }

        function setVoteModal(sectionAddress) {
            upVoteButton.setAttribute("onclick","vote('"+sectionAddress+"', true)");
            downVoteButton.setAttribute("onclick","vote('"+sectionAddress+"', false)")
        }

        function vote(sectionAddress, vote) {
            var comment = voteComment.value;
            console.log(comment);
            ipfs.add(comment)
                .then(function(response) {
                    console.log("ipfs section hash : " + response);
                    console.log(response);
                    var ipfsHash = response[0].hash
                    iSectionContract = getContract(iSectionAbi, sectionAddress);
                    iSectionContract.methods.vote(new Boolean(vote),ipfsHash).send({from : account})
                    .then(function(response){
                        console.log(response)
                    })
                    .catch(function(err) {
                        console.log(err);
                    });
                })
                .catch(function(err) {
                    console.log(err);
                });
        }


        const form = new FormData();

        const options = {
            method: 'POST',
            body: form,
            headers: {
                "Authorization": "222b05ce-c37f-4bdd-b40e-2a94f3efa570",
            },
        };

        const mintResponse = document.getElementById("mint_result");

        async function mintSectionNFT(mintAddress, user, _sectionContent, _sectionTitle) {
            console.log("minting" + mintAddress + " " + user + " " + text);
            let blob = new Blob([sectionContent], {
                type: 'text/plain'
            });
            console.log("sectionContent: " + blob.value);
            form.append('file', blob);

            await fetch("https://api.nftport.xyz/v0/mints/easy/files?" + new URLSearchParams({
                    chain: 'rinkeby',
                    name: "Proposal Section By " + user,
                    description: sectionTitle,
                    mint_to_address: mintAddress,
                }), options)
                .then(function(response) {
                    return response.json()
                })
                .then(function(responseJson) {
                    // Handle the response
                    console.log(responseJson.transaction_external_url);

                    var date = new Date();
                    const options = {
                        timeZone: "GMT",
                        year: "numeric",
                        month: "numeric",
                        day: "numeric",
                        hour12: false,
                        hour: "numeric",
                        minute: "numeric",
                        seconds: "numeric"
                    }
                    var localized = date.toLocaleDateString("en-UK", options);
                    console.log(responseJson);
                })
                .catch(function(err) {
                    console.log(err);
                })
            console.log("minted");
        }

        var dateOptions = {
            year: 'numeric',
            month: 'numeric',
            day: 'numeric'
        };


        function formatTimeRemaining(v)  {
            if(v < 60){
                return v + " secs"
            }
            if(v < 3600) {
                return (v /60) + " mins";
            }
            if(v < (3600 *24)){
                return v / 3600 + " hours";
            }
        }

        async function approve(address, amount) {
            console.log(" approve token address : " + address);
            console.log(" amount : " + amount);
            iErc20 = getContract(iERC20MetadataAbi, address); 

            console.log("idpa : " + iDesignProposalAddress);

            var res = await iErc20.methods.approve(iDesignProposalAddress, BigInt(amount)).send({from : account})
                                .then(function(response){
                                    console.log(response);
                                    return response.blockHash; 
                                })
                                .catch(function(err) {
                                    console.log(err);
                                    return err.message; 
                                });
            return res; 
        }


        function getContract(abi, address) {
            return new web3.eth.Contract(abi, address);
        }

        function formatDate(date) {
            return date.toLocaleDateString("en-UK", dateOptions);
        }

        function text(txt) {
            return document.createTextNode(txt);
        }

        function ce(element) {
            return document.createElement(element);
        }

        function ge(id) {
            return document.getElementById(id);
        }
    </script>

</body>

</html>